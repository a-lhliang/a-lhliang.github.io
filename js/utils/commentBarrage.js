var commentBarrageConfig={maxBarrage:1,barrageTime:4e3,twikooUrl:"https://twikoo.lhliang.com:14433/",accessToken:"e3fde5ee4bc1bb8c5021357dfbea59b6",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,dom:document.querySelector(".comment-barrage")},commentInterval=null,hoverOnCommentBarrage=!1;function initCommentBarrage(){let e=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":commentBarrageConfig.accessToken,url:commentBarrageConfig.pageUrl}),t=new XMLHttpRequest;t.withCredentials=!0,t.addEventListener("readystatechange",(function(){4===this.readyState&&(commentBarrageConfig.barrageList=commentLinkFilter(JSON.parse(this.responseText).data),commentBarrageConfig.dom.innerHTML="")})),t.open("POST",commentBarrageConfig.twikooUrl),t.setRequestHeader("Content-Type","application/json"),t.send(e),clearInterval(commentInterval),commentInterval=null,commentInterval=setInterval((()=>{commentBarrageConfig.barrageList.length&&!hoverOnCommentBarrage&&(popCommentBarrage(commentBarrageConfig.barrageList[commentBarrageConfig.barrageIndex]),commentBarrageConfig.barrageIndex+=1,commentBarrageConfig.barrageIndex%=commentBarrageConfig.barrageList.length),commentBarrageConfig.barrageTimer.length>(commentBarrageConfig.barrageList.length>commentBarrageConfig.maxBarrage?commentBarrageConfig.maxBarrage:commentBarrageConfig.barrageList.length)&&!hoverOnCommentBarrage&&removeCommentBarrage(commentBarrageConfig.barrageTimer.shift())}),commentBarrageConfig.barrageTime)}function commentLinkFilter(e){e.sort(((e,t)=>e.created-t.created));let t=[];return e.forEach((e=>{t.push(...getCommentReplies(e))})),t}function getCommentReplies(e){if(e.replies){let t=[e];return e.replies.forEach((e=>{t.push(...getCommentReplies(e))})),t}return[]}function popCommentBarrage(e){let t=document.createElement("div");commentBarrageConfig.dom.clientWidth,commentBarrageConfig.dom.clientHeight,t.className="comment-barrage-item",t.innerHTML=` \n\t\t<div class="barrageHead">\n      <a class="barrageTitle" href="javascript:LHL.scrollTo('#post-comment')"">热评</a>\n\t\t\t<div class="barrageNick">${e.nick}</div>\n\t\t\t<img class="barrageAvatar" src="https://cravatar.cn/avatar/${e.mailMd5}" alt="${e.nick}"/>\n\t\t\t<a class="comment-barrage-close" href="javascript:LHL.switchCommentBarrage()"><i class="lhlfont icon-close"></i></a>\n\t\t</div>\n\t\t<a class="barrageContent" href="#${e.id}">${e.comment}</a>\n\t`,commentBarrageConfig.barrageTimer.push(t),commentBarrageConfig.dom.append(t)}function removeCommentBarrage(e){e.className="comment-barrage-item out",setTimeout((()=>{commentBarrageConfig.dom.removeChild(e)}),1e3)}$(".comment-barrage").hover((function(){hoverOnCommentBarrage=!0}),(function(){hoverOnCommentBarrage=!1})),document.addEventListener("scroll",pty.throttle((function(){let e=window.scrollY+document.documentElement.clientHeight,t=(window.scrollY,document.querySelector(".comment-barrage")),a=document.getElementById("post-tools");if(a&&t){let r=a.offsetTop+a.offsetHeight/2;document.body.clientWidth>768&&(t.style.bottom=r>e?"0":"-200px")}}),200)),initCommentBarrage(),"false"!==localStorage.getItem("commentBarrageSwitch")?($(".comment-barrage").show(),$(".menu-commentBarrage-text").text("关闭热评"),document.querySelector("#consoleCommentBarrage").classList.add("on")):($(".comment-barrage").hide(),$(".menu-commentBarrage-text").text("显示热评"),document.querySelector("#consoleCommentBarrage").classList.remove("on")),document.addEventListener("pjax:send",(function(){clearInterval(commentInterval)}));