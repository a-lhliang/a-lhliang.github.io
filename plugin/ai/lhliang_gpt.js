let LHLGPTIsRunning=!1,LHL_aiPostExplanation="",GPTModel="LHLGPT",aiTalkMode=!1;var GPT={aiExplanation:async function(){const n=document.querySelector(".ai-explanation");if(!n)return;""===LHL_aiPostExplanation&&(LHL_aiPostExplanation=n.innerText);const e=GPT.synonymReplace(LHL_aiPostExplanation);GPT.aiShowAnimation(Promise.resolve(e))},loadLHLgpt:async function(){if(null===lhlgpt){const n=await fetch("/json/lhlgpt.json");lhlgpt=await n.json()}},getTitleAndContent:function(){const n=document.title,e=document.getElementById("article-container"),t=e.getElementsByTagName("p"),o=e.querySelectorAll("h1, h2, h3, h4, h5");let i="";for(let n of o)i+=n.innerText+" ";for(let n of t)i+=n.innerText.replace(/https?:\/\/[^\s]+/g,"");const a=(n+" "+i).slice(0,1e3);return console.log("lhliang:"+a),a},fetchTianliGPT:async function(n,e){const t=`https://summary.tianli0.top/?content=${encodeURIComponent(n)}&key=${encodeURIComponent(e)}`;try{const n=new AbortController,e=await fetch(t,{signal:n.signal});if(e.ok)return(await e.json()).summary;throw Error("请求失败")}catch(n){return"AbortError"===n.name?console.error("请求超时"):console.error("请求失败：",n),"获取文章摘要超时。当你出现这个问题时，可能是因为文章过长导致的AI运算量过大， 您可以稍等一下然后重新切换到TianliGPT模式，或者尝试使用LHLGPT模式。"}},tianliGPTGenerate:async function(){const n=GPT.fetchTianliGPT(GPT.getTitleAndContent(),"7ChCvmgZcpvIeUzBrJ2S");GPT.aiShowAnimation(n)},toggleGPTModel:function(){if(LHLGPTIsRunning)return;const n=document.getElementById("ai-tag");"TianliGPT"===GPTModel?(GPTModel="LHLGPT",GPT.aiShowAnimation(Promise.resolve(LHL_aiPostExplanation)),n.innerText="LHLGPT"):(GPTModel="TianliGPT",GPT.tianliGPTGenerate(),n.innerText="TianliGPT")},aiShowAnimation:function(n,e=!1){const t=document.querySelector(".ai-explanation");if(!t)return;if(LHLGPTIsRunning)return;LHLGPTIsRunning=!0,GPT.cleanSuggestions(),document.querySelector(".ai-title-icon").classList.add("loadingAI"),t.style.display="block",t.innerHTML='生成中...<span class="blinking-cursor"></span>';let o,i,a=!0,s=0,l=!0;const r=new IntersectionObserver((n=>{let e=n[0].isIntersecting;e&&!a?(a=!0,requestAnimationFrame(i)):e||(a=!1)}),{threshold:0});n.then((n=>{o=performance.now(),i=()=>{if(s<n.length&&a){const l=performance.now(),c=l-o,T=n.slice(s,s+1),u=/[，。！、？,.!?]/.test(T),g=/[a-zA-Z0-9]/.test(T);let P;P=u?100*Math.random()+100:g?10:25,c>=P&&(t.innerText=n.slice(0,s+1),o=l,s++,s<n.length?t.innerHTML=n.slice(0,s)+'<span class="blinking-cursor"></span>':(t.innerHTML=n,t.style.display="block",LHLGPTIsRunning=!1,document.querySelector(".ai-title-icon").classList.remove("loadingAI"),r.disconnect(),e&&GPT.createSuggestions())),a&&requestAnimationFrame(i)}},a&&l&&setTimeout((()=>{requestAnimationFrame(i),l=!1}),3e3),r.observe(t)})).catch((n=>{console.error("获取信息失败:",n),t.innerHTML="获取信息失败",t.style.display="block",LHLGPTIsRunning=!1,document.querySelector(".ai-tag").classList.remove("loadingAI"),r.disconnect()}))},synonymReplace:async function(n){await GPT.loadLHLgpt();const e=Object.keys(lhlgpt);for(let t=0;t<e.length;t++){const o=e[t],i=lhlgpt[o],a=RegExp(o,"gi");n=n.replace(a,(()=>{const n=Math.floor(Math.random()*i.length);return i[n]}))}return n},createSuggestionItemWithAction:function(n,e){const t=document.querySelector(".ai-suggestions");if(!t)return void console.error("无法找到具有class为ai-suggestions的元素");const o=document.createElement("div");o.classList.add("ai-suggestions-item"),o.textContent=n,o.addEventListener("click",(()=>{e()})),t.appendChild(o)},cleanSuggestions:function(){const n=document.querySelector(".ai-suggestions");n?n.innerHTML="":console.error("无法找到具有class为ai-suggestions的元素")},createSuggestions:function(){aiTalkMode&&(GPT.cleanSuggestions(),"LHLGPT"===GPTModel?(GPT.createSuggestionItemWithAction("博主介绍？",(()=>{GPT.aiShowAnimation(Promise.resolve("博主 是一位技术顾问，他的主要职业是IT售前工程师、技术架构师，同时也是一名前端爱好者。如果您想了解更多关于博主的信息，可以访问博客的关于本站介绍。"))})),GPT.createSuggestionItemWithAction("这篇文章讲了什么？",(()=>{GPT.aiShowAnimation(Promise.resolve(LHL_aiPostExplanation))})),GPT.createSuggestionItemWithAction("带我去看看其他文章",(()=>toRandomPost()))):"TianliGPT"===GPTModel&&console.log("TianliGPT生成的文章摘要成功"))}};function LHLGPTTalkMode(){document.querySelectorAll(".ai-suggestions")&&GPT.aiShowAnimation(Promise.resolve("我是博主的文章摘要生成助理，是一个基于GPT-4与Correction的混合语言模型。我在这里只负责摘要的预生成和显示，你无法与我直接沟通，但我可以回答一些预设的问题。"))}function tianliGPTTalkMode(){document.querySelectorAll(".ai-suggestions")&&GPT.aiShowAnimation(Promise.resolve("你好，我是Tianli开发的摘要生成助理TianliGPT，是一个基于GPT-3.5的生成式AI。我在这里只负责摘要的实时生成和显示，你无法与我直接沟通。"))}