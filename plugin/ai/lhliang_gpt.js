let LHLGPTIsRunning=!1,LHL_aiPostExplanation="",LHLGPTModel="LHLGPT",aiTalkMode=!1;var LHLGPT={aiExplanation:async function(){const e=document.querySelector(".ai-explanation");if(!e)return;""===LHL_aiPostExplanation&&(LHL_aiPostExplanation=e.innerText);const n=LHLGPT.synonymReplace(LHL_aiPostExplanation);LHLGPT.aiShowAnimation(Promise.resolve(n))},loadLHLgpt:async function(){if(null===lhlgpt){const e=await fetch("/json/lhlgpt.json");lhlgpt=await e.json()}},getTitleAndContent:function(){const e=document.title,n=document.getElementById("article-container"),t=n.getElementsByTagName("p"),o=n.querySelectorAll("h1, h2, h3, h4, h5");let i="";for(let e of o)i+=e.innerText+" ";for(let e of t)i+=e.innerText.replace(/https?:\/\/[^\s]+/g,"");const a=(e+" "+i).slice(0,1e3);return console.log("lhliang:"+a),a},fetchTianliGPT:async function(e,n){const t=`https://summary.tianli0.top/?content=${encodeURIComponent(e)}&key=${encodeURIComponent(n)}`;try{const e=new AbortController,n=await fetch(t,{signal:e.signal});if(n.ok)return(await n.json()).summary;throw Error("请求失败")}catch(e){return"AbortError"===e.name?console.error("请求超时"):console.error("请求失败：",e),"获取文章摘要超时。当你出现这个问题时，可能是因为文章过长导致的AI运算量过大， 您可以稍等一下然后重新切换到TianliGPT模式，或者尝试使用LHLGPT模式。"}},tianliGPTGenerate:async function(){const e=LHLGPT.fetchTianliGPT(LHLGPT.getTitleAndContent(),"7ChCvmgZcpvIeUzBrJ2S");LHLGPT.aiShowAnimation(e)},toggleGPTModel:function(){if(LHLGPTIsRunning)return;const e=document.getElementById("ai-tag");"TianliGPT"===LHLGPTModel?(LHLGPTModel="LHLGPT",LHLGPT.aiShowAnimation(Promise.resolve(LHL_aiPostExplanation)),e.innerText="LHLGPT"):(LHLGPTModel="TianliGPT",LHLGPT.tianliGPTGenerate(),e.innerText="TianliGPT")},aiShowAnimation:function(e,n=!1){const t=document.querySelector(".ai-explanation");if(!t)return;if(LHLGPTIsRunning)return;LHLGPTIsRunning=!0,LHLGPT.cleanSuggestions(),document.querySelector(".ai-title-icon").classList.add("loadingAI"),t.style.display="block",t.innerHTML='生成中...<span class="blinking-cursor"></span>';let o,i,a=!0,s=0,l=!0;const r=new IntersectionObserver((e=>{let n=e[0].isIntersecting;n&&!a?(a=!0,requestAnimationFrame(i)):n||(a=!1)}),{threshold:0});e.then((e=>{o=performance.now(),i=()=>{if(s<e.length&&a){const l=performance.now(),c=l-o,L=e.slice(s,s+1),T=/[，。！、？,.!?]/.test(L),u=/[a-zA-Z0-9]/.test(L);let g;g=T?100*Math.random()+100:u?10:25,c>=g&&(t.innerText=e.slice(0,s+1),o=l,s++,s<e.length?t.innerHTML=e.slice(0,s)+'<span class="blinking-cursor"></span>':(t.innerHTML=e,t.style.display="block",LHLGPTIsRunning=!1,document.querySelector(".ai-title-icon").classList.remove("loadingAI"),r.disconnect(),n&&LHLGPT.createSuggestions())),a&&requestAnimationFrame(i)}},a&&l&&setTimeout((()=>{requestAnimationFrame(i),l=!1}),3e3),r.observe(t)})).catch((e=>{console.error("获取信息失败:",e),t.innerHTML="获取信息失败",t.style.display="block",LHLGPTIsRunning=!1,document.querySelector(".ai-title-icon").classList.remove("loadingAI"),r.disconnect()}))},synonymReplace:async function(e){await LHLGPT.loadLHLgpt();const n=Object.keys(lhlgpt);for(let t=0;t<n.length;t++){const o=n[t],i=lhlgpt[o],a=RegExp(o,"gi");e=e.replace(a,(()=>{const e=Math.floor(Math.random()*i.length);return i[e]}))}return e},createSuggestionItemWithAction:function(e,n){const t=document.querySelector(".ai-suggestions");if(!t)return void console.error("无法找到具有class为ai-suggestions的元素");const o=document.createElement("div");o.classList.add("ai-suggestions-item"),o.textContent=e,o.addEventListener("click",(()=>{n()})),t.appendChild(o)},cleanSuggestions:function(){const e=document.querySelector(".ai-suggestions");e?e.innerHTML="":console.error("无法找到具有class为ai-suggestions的元素")},createSuggestions:function(){aiTalkMode&&(LHLGPT.cleanSuggestions(),"LHLGPT"===LHLGPTModel?(LHLGPT.createSuggestionItemWithAction("博主介绍？",(()=>{LHLGPT.aiShowAnimation(Promise.resolve("博主 是一位技术顾问，他的主要职业是IT售前工程师、技术架构师，同时也是一名前端爱好者。如果您想了解更多关于博主的信息，可以访问博客的关于本站介绍。"),!0)})),LHLGPT.createSuggestionItemWithAction("这篇文章讲了什么？",(()=>{LHLGPT.aiShowAnimation(Promise.resolve(LHL_aiPostExplanation),!0)})),LHLGPT.createSuggestionItemWithAction("带我去看看其他文章",(()=>toRandomPost()))):"TianliGPT"===LHLGPTModel&&LHLGPT.createSuggestionItemWithAction("带我去Tianli的博客",(()=>{window.open("https://tianli-blog.club/","_blank")})))}};function AIEngine(){const e=document.querySelector(".ai-tag");e&&e.addEventListener("click",(()=>{LHLGPTIsRunning||(aiTalkMode=!0,"LHLGPT"===LHLGPTModel?LHLGPTTalkMode():tianliGPTTalkMode())}))}function addAIToggleListener(){const e=document.querySelector("#ai-Toggle");e&&e.addEventListener("click",(()=>{LHLGPT.toggleGPTModel()}))}function LHLGPTTalkMode(){document.querySelectorAll(".ai-suggestions")&&LHLGPT.aiShowAnimation(Promise.resolve("我是博主的文章摘要生成助理，是一个基于GPT-4与Correction的混合语言模型。我在这里只负责摘要的预生成和显示，你无法与我直接沟通。"),!0)}function tianliGPTTalkMode(){document.querySelectorAll(".ai-suggestions")&&LHLGPT.aiShowAnimation(Promise.resolve("你好，我是摘要生成助理TianliGPT，TianliGPT在访客访问时进行摘要的撰写。我在这里只负责摘要的实时生成和显示，你无法与我直接沟通。"),!0)}