let LHLGPTIsRunning=!1,LHL_aiPostExplanation="",LHLGPTModel="文章摘要",aiTalkMode=!1;const LHLGPT={aiExplanation:async function(){const n=document.querySelector(".ai-explanation");if(!n)return;""===LHL_aiPostExplanation&&(LHL_aiPostExplanation=n.innerText);const e=await LHLGPT.synonymReplace(LHL_aiPostExplanation);LHLGPT.aiShowAnimation(Promise.resolve(e))},loadLHLgpt:async function(){if(null===lhlgpt){const n=await fetch("/json/lhlgpt.json");lhlgpt=await n.json()}},getTitleAndContent:function(){const n=document.title,e=document.getElementById("article-container"),t=e.getElementsByTagName("p"),o=e.querySelectorAll("h1, h2, h3, h4, h5");let i="";o.forEach((n=>i+=n.innerText+" ")),t.forEach((n=>i+=n.innerText.replace(/https?:\/\/[^\s]+/g,"")));const a=(n+" "+i).slice(0,1e3);return console.log("lhliang:"+a),a},fetchTianliGPT:async function(n,e){const t=`https://summary.tianli0.top/?content=${encodeURIComponent(n)}&key=${encodeURIComponent(e)}`;try{const n=new AbortController,e=await fetch(t,{signal:n.signal});if(e.ok)return(await e.json()).summary;throw new Error("请求失败")}catch(n){return"AbortError"===n.name?console.error("请求超时"):console.error("请求失败：",n),"获取文章摘要超时。当你出现这个问题时，可能是因为文章过长导致的AI运算量过大， 您可以稍等一下然后重新切换到TianliGPT模式，或者尝试使用LHLGPT模式。"}},tianliGPTGenerate:async function(){const n=LHLGPT.getTitleAndContent(),e=await LHLGPT.fetchTianliGPT(n,"7ChCvmgZcpvIeUzBrJ2S");LHLGPT.aiShowAnimation(Promise.resolve(e))},toggleGPTModel:function(){if(LHLGPTIsRunning)return;const n=document.getElementById("ai-title-text");"TianliGPT"===LHLGPTModel?(LHLGPTModel="文章摘要",LHLGPT.aiShowAnimation(Promise.resolve(LHL_aiPostExplanation)),n.innerText="文章摘要"):(LHLGPTModel="TianliGPT",LHLGPT.tianliGPTGenerate(),n.innerText="TianliGPT")},aiShowAnimation:function(n,e=!1){const t=document.querySelector(".ai-explanation");if(!t||LHLGPTIsRunning)return;LHLGPTIsRunning=!0,LHLGPT.cleanSuggestions(),t.style.display="block",t.innerHTML='生成中...<span class="blinking-cursor"></span>';let o,i,a=!0,s=0,l=!0;const r=new IntersectionObserver((n=>{const e=n[0].isIntersecting;e&&!a?(a=!0,requestAnimationFrame(i)):e||(a=!1)}),{threshold:0});n.then((n=>{o=performance.now(),i=()=>{if(s<n.length&&a){const l=performance.now(),c=l-o,L=n.slice(s,s+1),T=/[，。！、？,.!?]/.test(L),u=/[a-zA-Z0-9]/.test(L);let g;g=T?100*Math.random()+100:u?10:25,c>=g&&(t.innerText=n.slice(0,s+1),o=l,s++,s<n.length?t.innerHTML=n.slice(0,s)+'<span class="blinking-cursor"></span>':(t.innerHTML=n,t.style.display="block",LHLGPTIsRunning=!1,r.disconnect(),e&&LHLGPT.createSuggestions())),a&&requestAnimationFrame(i)}},a&&l&&setTimeout((()=>{requestAnimationFrame(i),l=!1}),3e3),r.observe(t)})).catch((n=>{console.error("获取信息失败:",n),t.innerHTML="获取信息失败",t.style.display="block",LHLGPTIsRunning=!1,r.disconnect()}))},synonymReplace:async function(n){await LHLGPT.loadLHLgpt();return Object.keys(lhlgpt).forEach((e=>{const t=lhlgpt[e],o=new RegExp(e,"gi");n=n.replace(o,(()=>{const n=Math.floor(Math.random()*t.length);return t[n]}))})),n},createSuggestionItemWithAction:function(n,e){const t=document.querySelector(".ai-suggestions");if(!t)return void console.error("无法找到具有class为ai-suggestions的元素");const o=document.createElement("div");o.classList.add("ai-suggestions-item"),o.textContent=n,o.addEventListener("click",e),t.appendChild(o)},cleanSuggestions:function(){const n=document.querySelector(".ai-suggestions");n?n.innerHTML="":console.error("无法找到具有class为ai-suggestions的元素")},createSuggestions:function(){aiTalkMode&&(LHLGPT.cleanSuggestions(),"文章摘要"===LHLGPTModel?(LHLGPT.createSuggestionItemWithAction("博主介绍？",(()=>{LHLGPT.aiShowAnimation(Promise.resolve("博主 是一位技术顾问，他的主要职业是IT售前工程师、技术架构师，同时也是一名前端爱好者。如果您想了解更多关于博主的信息，可以访问博客的关于本站介绍。"),!0)})),LHLGPT.createSuggestionItemWithAction("这篇文章讲了什么？",(()=>{LHLGPT.aiShowAnimation(Promise.resolve(LHL_aiPostExplanation),!0)})),LHLGPT.createSuggestionItemWithAction("带我去看看其他文章",(()=>toRandomPost()))):"TianliGPT"===LHLGPTModel&&LHLGPT.createSuggestionItemWithAction("带我去Tianli的博客",(()=>{window.open("https://tianli-blog.club/","_blank")})))}};function AIEngine(){const n=document.querySelector(".ai-title-text");n&&n.addEventListener("click",(()=>{LHLGPTIsRunning||(aiTalkMode=!0,"文章摘要"===LHLGPTModel?LHLGPTTalkMode():tianliGPTTalkMode())}))}function addAIToggleListener(){const n=document.querySelector("#ai-Toggle");n&&n.addEventListener("click",(()=>{LHLGPT.toggleGPTModel()}))}function LHLGPTTalkMode(){document.querySelectorAll(".ai-suggestions")&&LHLGPT.aiShowAnimation(Promise.resolve("我是博主的文章摘要生成助理，是一个基于GPT-4与Correction的混合语言模型。我在这里只负责摘要的预生成和显示，你无法与我直接沟通。"),!0)}function tianliGPTTalkMode(){document.querySelectorAll(".ai-suggestions")&&LHLGPT.aiShowAnimation(Promise.resolve("你好，我是摘要生成助理TianliGPT，TianliGPT在访客访问时进行摘要的撰写。我在这里只负责摘要的实时生成和显示，你无法与我直接沟通。"),!0)}